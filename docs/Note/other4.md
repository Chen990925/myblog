---
group:
  title: 计算机网络
  order: 8
title: HTTPS的加密过程
---

# HTTPS 的加密

## 为什么需要加密？

因为 http 的内容是明文传输的，在传输过程中会经过中间代理服务器、路由器等多个物理节点。如果内容在中途被人劫持，传输的内容就完全暴露了。且劫持者还可以篡改内容且不被传输方和接收方察觉。这就是`中间人攻击`。所以需要加密，其中加密分为`对称加密`和`非对称加密`。

## 对称加密

加密和解密的密钥是同一个。但是有个问题，如何让传输和接收双方都持有同一个密钥？服务端生成一个密钥传输给客户端，这样又回到中间人攻击的问题中了。显然不太现实。

## 不对称加密

加密和解密的密钥不是同一个，通常分为私钥和公钥。公钥加密的内容必须要私钥才能解开。但是这样只能保证一个方向的通信安全。

那可以考虑用俩组不对称加密的密钥来解决吗？

例如:

- 浏览器拥有公钥 A，私钥 A`

- 服务器拥有公钥 B，私钥 B`
- 浏览器将 A 明文给服务器
- 服务器将 B 明文给浏览器
- 这样俩端通过公钥加密的内容，只有具备对应私钥才能解开。

但是 https 并没有采用这种方式，主要是非对称加密算法非常耗时。

## 非对称加密+对称加密？

简单来说就是利用非对称加密来加密传递对称加密的密钥。这样对称加密的密钥似乎就不会有被劫持获取的风险了。

当其实还有问题。

- 服务器有非对称加密的公钥 A 和私钥 A`
- 将公钥 A 明文给浏览器，让浏览器用公钥 A 去加密自己的对称加密密钥。（就在这，中间人劫持了公钥 A，替换成自己的非对称加密的公钥 B）。
- 接着浏览器将通过公钥 B 加密的对称加密密钥传输出去
- 中间人拿到传输内容，通过自己的私钥 B`解开，拿到内容。然后再用公钥 A 加密传给服务器。

所有的证明身份的源头都是密钥，但是密钥也要证明自己是对的密钥。故密钥也要有身份验证系统，即数字证书。

## 数字证书

在使用 HTTPS 前，要向 CA 机构申请一个数字证书，证书中包含了持有者信息、公钥信息等。服务器会传给浏览器，但是还有个问题，数字证书的防伪性该如何验证？

## 数字签名

数字签名的制作过程：

1. CA 机构拥有非对称加密的私钥和公钥。
2. CA 机构对证书明文数据 T 进行 hash。
3. 对 hash 后的值用私钥加密，得到数字签名 S。

如果中间人截获了该数字证书，修改数字证书明文信息。浏览器通过 CA 机构的公钥解密数字签名 S，发现和明文信息对不上。同时对于数字签名 S，它也没有 CA 机构的私钥，解密后没办法加密回去。
如果中间人替换了该数字证书也没用，数字证书会有请求的域名信息，浏览器会进行对比。

## 总结

简化下 HTTPS 的加密过程：

- 通过数字证书传递非对称密钥的公钥
- 将对称密钥通过拿到公钥加密
- 服务器拿到后通过私钥解密
